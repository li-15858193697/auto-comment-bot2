name: Auto Comment and Close Issues

on:
  issues:
    types: [opened, labeled]

permissions:
  issues: write
  contents: read

jobs:
  auto-comment-close:
    runs-on: ubuntu-latest
    
    steps:
      - name: Check labels and process
        id: check-labels
        run: |
          # Debug: Print all labels
          echo "Event action: ${{ github.event.action }}"
          echo "Issue labels: ${{ join(github.event.issue.labels.*.name, ', ') }}"
          
          # Check if issue has feedback or suggestion label
          HAS_FEEDBACK=false
          HAS_SUGGESTION=false
          
          # Loop through labels (if any)
          LABELS="${{ join(github.event.issue.labels.*.name, ',') }}"
          if [[ "$LABELS" == *"feedback"* ]]; then
            HAS_FEEDBACK=true
          fi
          if [[ "$LABELS" == *"suggestion"* ]]; then
            HAS_SUGGESTION=true
          fi
          
          if [[ "$HAS_FEEDBACK" == "true" || "$HAS_SUGGESTION" == "true" ]]; then
            echo "should_process=true" >> $GITHUB_OUTPUT
            echo "Found feedback or suggestion label"
          else
            echo "should_process=false" >> $GITHUB_OUTPUT
            echo "No feedback or suggestion label found"
          fi
          
      - name: Add thank you comment
        if: steps.check-labels.outputs.should_process == 'true'
        uses: actions/github-script@v7
        with:
          script: |
            console.log('Adding comment to issue #' + context.issue.number);
            await github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: 'Thank you for your contribution!'
            });
            
      - name: Close the issue
        if: steps.check-labels.outputs.should_process == 'true'
        uses: actions/github-script@v7
        with:
          script: |
            console.log('Closing issue #' + context.issue.number);
            await github.rest.issues.update({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              state: 'closed'
            });